{
  "version": "7.2.2.79281",
  "description": "Firestorm Viewer Beta â€” pre-release (Early Access) build",
  "homepage": "https://www.firestormviewer.org/",
  "license": "GPL-2.0-or-later",
  "depends": "7zip",
  "architecture": {
    "64bit": {
      "url": "https://downloads.firestormviewer.org/preview/windows/Phoenix-Firestorm-Betax64_AVX2-7-2-2-79281_Setup.exe",
      "hash": "sha256:874F22724BF3206C28EC70559D4613FDD28183A7F58EB720DEE648090E5AE4CC"
    }
  },
  "installer": {
    "script": [
      "$setup = (Get-ChildItem $dir -Filter *.exe | Select-Object -First 1).FullName",
      "# 1) Extract payload from the NSIS installer into $dir",
      "7z x \"$setup\" -o\"$dir\" -y | Out-Null",
      "",
      "# 2) If there is exactly one top-level directory, flatten it (move contents up into $dir)",
      "$topDirs = Get-ChildItem $dir -Directory",
      "if ($topDirs.Count -eq 1) {",
      "  $src = $topDirs[0].FullName",
      "  Get-ChildItem $src -Force | Move-Item -Destination $dir -Force",
      "  Remove-Item $src -Recurse -Force",
      "}"
    ]
  },
  "post_install": [
    "# Find the main Firestorm executable (exclude uninstall/setup/crash tools)",
    "$main = Get-ChildItem $dir -Recurse -Include \"Firestorm*.exe\" -Exclude \"*unins*\",\"*crash*\",\"*setup*\" | Sort-Object Length -Descending | Select-Object -First 1",
    "if (-not $main) { throw 'Could not locate Firestorm executable after extraction.' }",
    "Write-Host \"Detected main exe: $($main.FullName)\"",
    "",
    "# Create a Start Menu shortcut dynamically",
    "$shortcutDir = Join-Path $env:APPDATA 'Microsoft\\Windows\\Start Menu\\Programs'",
    "$lnkPath = Join-Path $shortcutDir 'Firestorm Beta.lnk'",
    "$sh = New-Object -ComObject WScript.Shell",
    "$lnk = $sh.CreateShortcut($lnkPath)",
    "$lnk.TargetPath = $main.FullName",
    "$lnk.WorkingDirectory = $main.DirectoryName",
    "$lnk.IconLocation = $main.FullName",
    "$lnk.Save()",
    "Write-Host \"Created shortcut: $lnkPath\""
  ],
  "uninstaller": {
    "script": [
      "# Remove our Start Menu shortcut; files in $dir are removed by Scoop",
      "$shortcut = Join-Path $env:APPDATA 'Microsoft\\Windows\\Start Menu\\Programs\\Firestorm Beta.lnk'",
      "if (Test-Path $shortcut) { Remove-Item $shortcut -Force }",
      "Write-Host 'Portable uninstall complete.'"
    ]
  }
}